# AGENTS.md - Quotio å¼€å‘æŒ‡å—

**ç”Ÿæˆæ—¶é—´**ï¼š2026-01-03 | **æäº¤**ï¼š1995a85 | **åˆ†æ”¯**ï¼šmaster

## æ¦‚è¿°

åŸç”Ÿ macOS èœå•æ åº”ç”¨ï¼ˆSwiftUIï¼‰ï¼Œç”¨äºç®¡ç† CLIProxyAPI - AI ç¼–ç¨‹ä»£ç†çš„æœ¬åœ°ä»£ç†æœåŠ¡å™¨ã€‚å¤šæä¾›å•† OAuthã€é…é¢è·Ÿè¸ªã€CLI å·¥å…·é…ç½®ã€‚

**æŠ€æœ¯æ ˆ**ï¼šSwift 6ã€SwiftUIã€macOS 15+ã€Xcode 16+ã€Sparkleï¼ˆè‡ªåŠ¨æ›´æ–°ï¼‰

## ç»“æ„

```
Quotio/
â”œâ”€â”€ QuotioApp.swift           # @main å…¥å£ç‚¹ + AppDelegate + ContentView
â”œâ”€â”€ Models/                   # æšä¸¾ã€Codable ç»“æ„ä½“ã€è®¾ç½®ç®¡ç†å™¨
â”œâ”€â”€ Services/                 # ä¸šåŠ¡é€»è¾‘ã€API å®¢æˆ·ç«¯ã€actorsï¼ˆâ†’ AGENTS.mdï¼‰
â”œâ”€â”€ ViewModels/               # @Observable çŠ¶æ€ï¼ˆQuotaViewModelã€AgentSetupViewModelï¼‰
â”œâ”€â”€ Views/Components/         # å¯é‡ç”¨ UIï¼ˆâ†’ Views/AGENTS.mdï¼‰
â”œâ”€â”€ Views/Screens/            # å®Œæ•´é¡µé¢è§†å›¾
â””â”€â”€ Assets.xcassets/          # å›¾æ ‡ï¼ˆæä¾›å•†å›¾æ ‡ã€èœå•æ å›¾æ ‡ï¼‰
Config/                       # .xcconfig æ–‡ä»¶ï¼ˆDebug/Release/Localï¼‰
scripts/                      # æ„å»ºã€å‘å¸ƒã€å…¬è¯ï¼ˆâ†’ AGENTS.mdï¼‰
docs/                         # æ¶æ„æ–‡æ¡£
```

## æŸ¥æ‰¾ä½ç½®

| ä»»åŠ¡ | ä½ç½® | è¯´æ˜ |
|------|----------|-------|
| æ·»åŠ  AI æä¾›å•† | `Models/Models.swift` â†’ `AIProvider` æšä¸¾ | æ·»åŠ  case + è®¡ç®—å±æ€§ |
| æ·»åŠ é…é¢è·å–å™¨ | `Services/*QuotaFetcher.swift` | Actor æ¨¡å¼ï¼Œå‚è€ƒç°æœ‰è·å–å™¨ |
| æ·»åŠ  CLI ä»£ç† | `Models/AgentModels.swift` â†’ `CLIAgent` æšä¸¾ | + åœ¨ `AgentDetectionService` ä¸­æ£€æµ‹ |
| UI ç»„ä»¶ | `Views/Components/` | å¤ç”¨ `ProviderIcon`ã€`AccountRow`ã€`QuotaCard` |
| æ–°å±å¹• | `Views/Screens/` | æ·»åŠ åˆ° Models ä¸­çš„ `NavigationPage` æšä¸¾ |
| OAuth æµç¨‹ | `ViewModels/QuotaViewModel.swift` | `startOAuth()`ã€è½®è¯¢æ¨¡å¼ |
| èœå•æ  | `Services/StatusBarManager.swift` | å•ä¾‹ï¼Œä½¿ç”¨ `StatusBarMenuBuilder` |

## ä»£ç æ˜ å°„ï¼ˆå…³é”®ç¬¦å·ï¼‰

| ç¬¦å· | ç±»å‹ | ä½ç½® | è§’è‰² |
|--------|------|----------|------|
| `CLIProxyManager` | ç±» | Services/ | ä»£ç†ç”Ÿå‘½å‘¨æœŸã€äºŒè¿›åˆ¶ç®¡ç†ã€èº«ä»½éªŒè¯å‘½ä»¤ |
| `QuotaViewModel` | ç±» | ViewModels/ | ä¸­å¤®çŠ¶æ€ï¼šé…é¢ã€èº«ä»½éªŒè¯ã€æä¾›å•†ã€æ—¥å¿— |
| `ManagementAPIClient` | Actor | Services/ | CLIProxyAPI çš„ HTTP å®¢æˆ·ç«¯ |
| `AIProvider` | æšä¸¾ | Models/ | æä¾›å•†å®šä¹‰ï¼ˆ13 ä¸ªæä¾›å•†ï¼‰ |
| `CLIAgent` | æšä¸¾ | Models/ | CLI ä»£ç†å®šä¹‰ï¼ˆ6 ä¸ªä»£ç†ï¼‰ |
| `StatusBarManager` | ç±» | Services/ | èœå•æ å›¾æ ‡å’Œèœå• |
| `ProxyBridge` | ç±» | Services/ | ç”¨äºè¿æ¥ç®¡ç†çš„ TCP æ¡¥æ¥å±‚ |

## æ„å»ºå‘½ä»¤

```bash
# è°ƒè¯•æ„å»º
xcodebuild -project Quotio.xcodeproj -scheme Quotio -configuration Debug build

# å‘å¸ƒæ„å»º
./scripts/build.sh

# å®Œæ•´å‘å¸ƒï¼ˆæ„å»º + æ‰“åŒ… + å…¬è¯ + appcastï¼‰
./scripts/release.sh

# æ£€æŸ¥ç¼–è¯‘é”™è¯¯
xcodebuild -project Quotio.xcodeproj -scheme Quotio -configuration Debug build 2>&1 | head -50
```

## çº¦å®š

### Swift 6 å¹¶å‘æ€§ï¼ˆå…³é”®ï¼‰
```swift
// UI ç±»ï¼š@MainActor @Observable
@MainActor @Observable
final class StatusBarManager {
    static let shared = StatusBarManager()
    private init() {}
}

// çº¿ç¨‹å®‰å…¨æœåŠ¡ï¼šactor
actor ManagementAPIClient { ... }

// è·¨è¶Šè¾¹ç•Œçš„æ•°æ®ï¼šSendable
struct AuthFile: Codable, Sendable { ... }
```

### Observable æ¨¡å¼
```swift
// ViewModel
@MainActor @Observable
final class QuotaViewModel { var isLoading = false }

// è§†å›¾æ³¨å…¥
@Environment(QuotaViewModel.self) private var viewModel

// ç»‘å®š
@Bindable var vm = viewModel
```

### Codable ä½¿ç”¨ snake_case
```swift
struct AuthFile: Codable, Sendable {
    let statusMessage: String?
    enum CodingKeys: String, CodingKey {
        case statusMessage = "status_message"
    }
}
```

### è§†å›¾ç»“æ„
```swift
struct DashboardScreen: View {
    @Environment(QuotaViewModel.self) private var viewModel

    // MARK: - è®¡ç®—å±æ€§
    private var isReady: Bool { ... }

    // MARK: - Body
    var body: some View { ... }

    // MARK: - å­è§†å›¾
    private var headerSection: some View { ... }
}
```

## åæ¨¡å¼ï¼ˆç»ä¸ä½¿ç”¨ï¼‰

| æ¨¡å¼ | ä¸ºä»€ä¹ˆä¸å¥½ | åº”è¯¥ä½¿ç”¨ |
|---------|---------|---------|
| `Text("localhost:\(port)")` | åŒºåŸŸè®¾ç½®ä¸º "8.217" | `Text("localhost:" + String(port))` |
| è§†å›¾ä¸­ç›´æ¥ä½¿ç”¨ `UserDefaults` | ä¸ä¸€è‡´ | `@AppStorage("key")` |
| é˜»å¡ä¸»çº¿ç¨‹ | UI å†»ç»“ | `Task { await ... }` |
| å¼ºåˆ¶è§£åŒ…å¯é€‰å€¼ | å´©æºƒ | Guard/if-let |
| ç¡¬ç¼–ç å­—ç¬¦ä¸² | æ— å›½é™…åŒ– | `"key".localized()` |

## å…³é”®ä¸å˜æ€§

æ¥è‡ªä»£ç æ³¨é‡Š - **ç»ä¸èƒ½è¿å**ï¼š
- ProxyStorageManagerï¼š**ç»ä¸åˆ é™¤å½“å‰**ç‰ˆæœ¬
- AgentConfigurationServiceï¼šå¤‡ä»½**ç»ä¸è¦†ç›–**
- ProxyBridgeï¼šç›®æ ‡ä¸»æœº**å§‹ç»ˆä¸º localhost**
- CLIProxyManagerï¼šåŸºæœ¬ URL **å§‹ç»ˆç›´æ¥æŒ‡å‘ CLIProxyAPI**

## å…³é”®æ¨¡å¼

### å¹¶è¡Œå¼‚æ­¥è·å–
```swift
async let files = client.fetchAuthFiles()
async let stats = client.fetchUsageStats()
(self.authFiles, self.usageStats) = try await (files, stats)
```

### æ¨¡å¼æ„ŸçŸ¥é€»è¾‘
```swift
if modeManager.isQuotaOnlyMode {
    // ç›´æ¥è·å–ï¼Œæ— éœ€ä»£ç†
} else {
    // ä»£ç†æ¨¡å¼
}
```

### å¼±å¼•ç”¨ï¼ˆé˜²æ­¢å¾ªç¯å¼•ç”¨ï¼‰
```swift
weak var viewModel: QuotaViewModel?
```

## æµ‹è¯•

æ— è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚æ‰‹åŠ¨æµ‹è¯•ï¼š
- ä½¿ç”¨ `Cmd + R` è¿è¡Œ
- éªŒè¯äº®è‰²/æš—è‰²æ¨¡å¼
- æµ‹è¯•èœå•æ é›†æˆ
- æ£€æŸ¥æ‰€æœ‰æä¾›å•† OAuth
- éªŒè¯æœ¬åœ°åŒ–

## Git å·¥ä½œæµ

**ç»ä¸æäº¤åˆ° `master`**ã€‚åˆ†æ”¯å‘½åï¼š
- `feature/<name>` - æ–°åŠŸèƒ½
- `bugfix/<desc>` - é”™è¯¯ä¿®å¤
- `refactor/<scope>` - é‡æ„
- `docs/<content>` - æ–‡æ¡£

## ä¾èµ–é¡¹

- **Sparkle** - è‡ªåŠ¨æ›´æ–°ï¼ˆSPMï¼‰

## é…ç½®æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” |
|------|---------|
| `Config/Debug.xcconfig` | è°ƒè¯•æ„å»ºè®¾ç½® |
| `Config/Release.xcconfig` | å‘å¸ƒæ„å»ºè®¾ç½® |
| `Config/Local.xcconfig` | å¼€å‘äººå‘˜è¦†ç›–ï¼ˆgitignoredï¼‰ |
| `Quotio/Info.plist` | åº”ç”¨å…ƒæ•°æ®ã€URL æ–¹æ¡ˆ |
| `Quotio/Quotio.entitlements` | åº”ç”¨æƒé™ï¼ˆæ²™ç®±ç¦ç”¨ã€ç½‘ç»œå¯ç”¨ï¼‰ |

# Agentmap é›†æˆ

æœ¬é¡¹ç›®ä½¿ç”¨ **agentlens** è¿›è¡Œ AI ä¼˜åŒ–çš„æ–‡æ¡£ç®¡ç†ã€‚

## é˜…è¯»åè®®

éµå¾ªä»¥ä¸‹é¡ºåºä»¥é«˜æ•ˆç†è§£ä»£ç åº“ï¼š

1. **ä»è¿™é‡Œå¼€å§‹**ï¼š`.agentlens/INDEX.md` - é¡¹ç›®æ¦‚è§ˆå’Œæ¨¡å—è·¯ç”±
2. **AI æŒ‡ä»¤**ï¼š`.agentlens/AGENT.md` - å¦‚ä½•ä½¿ç”¨æ–‡æ¡£
3. **æ¨¡å—è¯¦æƒ…**ï¼š`.agentlens/modules/{module}/MODULE.md` - æ–‡ä»¶åˆ—è¡¨å’Œå…¥å£ç‚¹
4. **ç¼–è¾‘å‰æ£€æŸ¥**ï¼šæŸ¥çœ‹ `.agentlens/modules/{module}/memory.md` äº†è§£è­¦å‘Š/TODO

## æ–‡æ¡£ç»“æ„

```
.agentlens/
â”œâ”€â”€ INDEX.md              # ä»è¿™é‡Œå¼€å§‹ - å…¨å±€è·¯ç”±è¡¨
â”œâ”€â”€ AGENT.md              # AI ä»£ç†æŒ‡ä»¤
â”œâ”€â”€ modules/
â”‚   â””â”€â”€ {module-slug}/
â”‚       â”œâ”€â”€ MODULE.md     # æ¨¡å—æ‘˜è¦
â”‚       â”œâ”€â”€ outline.md    # å¤§æ–‡ä»¶çš„ç¬¦å·æ˜ å°„
â”‚       â”œâ”€â”€ memory.md     # è­¦å‘Šã€TODOã€ä¸šåŠ¡è§„åˆ™
â”‚       â””â”€â”€ imports.md    # ä¾èµ–å…³ç³»
â””â”€â”€ files/                # å¤æ‚æ–‡ä»¶çš„æ·±åº¦æ–‡æ¡£
```

## å¼€å‘æœŸé—´

- ä½¿ç”¨ `.agentlens/modules/{module}/outline.md` æŸ¥æ‰¾å¤§æ–‡ä»¶ä¸­çš„ç¬¦å·
- æ£€æŸ¥ `.agentlens/modules/{module}/imports.md` äº†è§£ä¾èµ–å…³ç³»
- å¯¹äºå¤æ‚æ–‡ä»¶ï¼Œè¯·å‚é˜… `.agentlens/files/{file-slug}.md`

## å‘½ä»¤

| ä»»åŠ¡ | å‘½ä»¤ |
|------|---------|
| é‡æ–°ç”Ÿæˆæ–‡æ¡£ | `agentlens` |
| å¿«é€Ÿæ›´æ–°ï¼ˆä»…æ›´æ”¹ï¼‰ | `agentlens --diff main` |
| æ£€æŸ¥æ˜¯å¦è¿‡æœŸ | `agentlens --check` |
| å¼ºåˆ¶å®Œå…¨é‡æ–°ç”Ÿæˆ | `agentlens --force` |

## å…³é”®æ¨¡å¼

- **æ¨¡å—è¾¹ç•Œ**ï¼š`mod.rs` (Rust)ã€`index.ts` (TS)ã€`__init__.py` (Python)
- **å¤§æ–‡ä»¶**ï¼š>500 è¡Œï¼Œæœ‰ç¬¦å·å¤§çº²
- **å¤æ‚æ–‡ä»¶**ï¼š>30 ä¸ªç¬¦å·ï¼Œæœ‰ L2 æ·±åº¦æ–‡æ¡£
- **ä¸­å¿ƒæ–‡ä»¶**ï¼šè¢« 3+ ä¸ªæ–‡ä»¶å¯¼å…¥ï¼Œæ ‡è®°ä¸º ğŸ”—
- **å†…å­˜æ ‡è®°**ï¼šTODOã€FIXMEã€WARNINGã€SAFETYã€RULE

---
*ç”± [agentlens](https://github.com/nguyenphutrong/agentlens) ç”Ÿæˆ*
