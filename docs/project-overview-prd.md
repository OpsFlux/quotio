# Quotio - 项目概述和产品需求文档 (PRD)

> **最后更新**: 2024年12月27日
> **版本**: 1.0.0
> **平台**: macOS 15.0+ (Sequoia)

---

## 目录

1. [项目目的](#project-purpose)
2. [目标用户](#target-users)
3. [关键功能](#key-features)
4. [支持的 AI 提供商](#supported-ai-providers)
5. [兼容的 CLI 代理](#compatible-cli-agents)
6. [应用模式](#app-modes)
7. [系统要求](#system-requirements)

---

## 项目目的

Quotio 是一个原生 macOS 应用，作为 **AI 编码助手的指挥中心**。它为管理 **CLIProxyAPI** 提供图形用户界面 - CLIProxyAPI 是一个为 AI 编码代理提供支持的本地代理服务器。

### 核心目标

1. **集中账户管理**: 在一个统一界面中管理来自不同服务的多个 AI 提供商账户。
2. **配额跟踪**: 通过实时视觉反馈监控所有连接账户的 API 使用和配额。
3. **CLI 工具配置**: 自动检测并配置流行的 AI 编码 CLI 工具以通过集中代理路由。
4. **无缝集成**: 提供菜单栏集成以快速检查状态而不中断工作流。

### 问题陈述

使用 AI 编码助手的开发人员经常需要：
- 管理不同 AI 提供商的多个账户
- 跟踪配额使用以避免服务中断
- 使用一致的设置配置多个 CLI 工具
- 监控实时使用统计

Quotio 通过提供统一的管理层、自动配置和配额跟踪来解决这些挑战。

---

## 目标用户

### 主要用户

1. **专业开发人员**: 每天使用 AI 编码助手并需要管理多个账户或团队分配的工程师。

2. **高级用户**: 与多个 AI 提供商合作并需要集中配额监控的开发人员。

3. **团队负责人/DevOps**: 负责管理 AI 工具访问和监控账户使用情况的人员。

### 用户角色

| 角色 | 使用场景 | 关键需求 |
|---------|----------|-----------|
| 独立开发人员 | 每天使用 2-3 个 AI 工具 | 配额跟踪、简单设置 |
| 自由职业者 | 多个客户账户 | 账户切换、使用监控 |
| 团队负责人 | 管理团队配额 | 仪表板概览、通知 |
| DevOps 工程师 | 基础设施管理 | 代理配置、API 密钥管理 |

---

## 关键功能

### 多提供商支持

通过统一界面连接和管理来自多个 AI 提供商的账户：
- 大多数提供商基于 OAuth 的认证
- Vertex AI 的服务账户 JSON 导入
- GitHub Copilot 和 Kiro 基于 CLI 的认证
- Cursor 的浏览器会话集成

### 配额跟踪

智能通知的可视化配额监控：
- 每个账户的配额细分
- 模型级使用跟踪
- 自动低配额警报
- 可配置的通知阈值
- 历史使用统计

### 代理配置

一键配置流行的 CLI 编码工具：
- 自动代理检测
- 配置生成 (JSON/TOML/Environment)
- Shell 配置集成 (zsh/bash/fish)
- 带复制到剪贴板的手动配置模式
- 模型槽自定义 (Opus/Sonnet/Haiku)

### 菜单栏集成

从 macOS 菜单栏始终可访问的状态：
- 代理状态指示器
- 每个提供商的配额百分比显示
- 自定义提供商图标
- 颜色编码状态 (绿色/黄色/红色)
- 快速访问弹出框

### 通知

关键事件的智能警报系统：
- 低配额警告（可配置阈值）
- 账户冷却期通知
- 代理崩溃警报
- 声音和横幅选项

### 自动更新

通过 Sparkle 框架的无缝更新体验：
- 后台更新检查
- 一键更新安装
- 更新日志显示

### 双语支持

完全本地化支持：
- 英语 (en)
- 越南语 (vi)

---

## 支持的 AI 提供商

| 提供商 | 认证方法 | 配额跟踪 | 手动认证 |
|----------|----------------------|----------------|-------------|
| **Google Gemini** | OAuth | 是 | 是 |
| **Anthropic Claude** | OAuth | 是（通过 CLI） | 是 |
| **OpenAI Codex** | OAuth | 是 | 是 |
| **Qwen Code** | OAuth | 否 | 是 |
| **Vertex AI** | 服务账户 JSON | 否 | 是 |
| **iFlow** | OAuth | 否 | 是 |
| **Antigravity** | OAuth | 是 | 是 |
| **Kiro (CodeWhisperer)** | CLI 认证 (Google/AWS) | 否 | 是 |
| **GitHub Copilot** | 设备代码流程 | 是 | 是 |
| **Cursor** | 浏览器会话 | 是 | 否（自动检测） |

### 提供商能力

- **OAuth 提供商**: Gemini、Claude、Codex、Qwen、iFlow、Antigravity
- **CLI 认证**: GitHub Copilot（设备代码）、Kiro（Google OAuth / AWS Builder ID）
- **文件导入**: Vertex AI（服务账户 JSON）
- **仅自动检测**: Cursor（从本地 Cursor 应用数据库读取）

---

## 兼容的 CLI 代理

Quotio 可以自动检测和配置以下 CLI 编码工具：

| 代理 | 二进制文件 | 配置类型 | 配置文件 |
|-------|--------|-------------|--------------|
| **Claude Code** | `claude` | JSON + Environment | `~/.claude/settings.json` |
| **Codex CLI** | `codex` | TOML + JSON | `~/.codex/config.toml`, `~/.codex/auth.json` |
| **Gemini CLI** | `gemini` | 仅 Environment | - |
| **Amp CLI** | `amp` | JSON + Environment | `~/.config/amp/settings.json`, `~/.local/share/amp/secrets.json` |
| **OpenCode** | `opencode`, `oc` | JSON | `~/.config/opencode/opencode.json` |
| **Factory Droid** | `droid`, `factory-droid`, `fd` | JSON | `~/.factory/config.json` |

### 配置模式

1. **自动模式**: 直接更新配置文件和 shell 配置
2. **手动模式**: 生成配置供用户复制和应用

### 模型槽配置

代理可以使用自定义模型路由进行配置：
- **Opus 槽**: 高智能任务（例如 `gemini-claude-opus-4-5-thinking`）
- **Sonnet 槽**: 平衡任务（例如 `gemini-claude-sonnet-4-5`）
- **Haiku 槽**: 快速/简单任务（例如 `gemini-3-flash-preview`）

---

## 应用模式

Quotio 支持两种操作模式以满足不同的用户需求：

### 完整模式（默认）

包括代理服务器管理的完整功能：

**功能：**
- 运行本地代理服务器 (CLIProxyAPI)
- 管理多个 AI 账户
- 配置 CLI 代理
- 在菜单栏跟踪配额
- 客户端的 API 密钥管理
- 请求/响应日志

**可见页面：**
- 仪表板
- 配额
- 提供商
- 代理
- API 密钥
- 日志
- 设置
- 关于

### 仅配额模式

用于配额监控的无代理开销的轻量级模式：

**功能：**
- 在菜单栏跟踪配额
- 不需要代理服务器
- 最小化的 UI 和资源使用
- 通过 CLI 命令直接配额获取
- 类似于 CodexBar / ccusage

**可见页面：**
- 仪表板
- 配额
- 账户（从提供商重命名）
- 设置
- 关于

### 模式选择

- 用户在引导期间选择首选模式
- 可以随时通过设置更改模式
- 从完整切换到仅配额会自动停止代理

---

## 系统要求

### 硬件要求

| 组件 | 最低 | 推荐 |
|-----------|---------|-------------|
| **架构** | Apple Silicon 或 Intel x64 | Apple Silicon |
| **内存** | 4 GB RAM | 8 GB RAM |
| **存储** | 100 MB 可用空间 | 200 MB 可用空间 |

### 软件要求

| 要求 | 版本 |
|-------------|---------|
| **macOS** | 15.0 (Sequoia) 或更高版本 |
| **Xcode**（用于开发） | 16.0+ |
| **Swift**（用于开发） | 6.0+ |

### 网络要求

- OAuth 认证的互联网连接
- 代理服务器的本地主机访问（默认端口 8317）
- 访问 GitHub API 以下载二进制文件

### 可选依赖项

- **Sparkle Framework**: 自动更新（通过 Swift Package Manager 捆绑）
- **CLI 工具**: 使用代理配置功能时必需

---

## 技术架构概述

```
┌─────────────────────────────────────────────────────────────┐
│                      Quotio (SwiftUI)                       │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │  仪表板  │  │   配额     │  │     提供商       │  │
│  │   屏幕    │  │   屏幕    │  │      屏幕         │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │   代理    │  │  API 密钥   │  │      设置       │  │
│  │   屏幕    │  │   屏幕    │  │       屏幕        │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
├─────────────────────────────────────────────────────────────┤
│                    QuotaViewModel                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ CLIProxy    │  │ Management  │  │    StatusBar        │  │
│  │  Manager    │  │ APIClient   │  │     Manager         │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │   配额     │  │   代理     │  │   Notification      │  │
│  │  Fetchers   │  │  Services   │  │     Manager         │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    CLIProxyAPI 二进制文件                        │
│            (本地 HTTP 代理，端口 8317)                   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
          ┌────────────────────────────────────┐
          │         AI 提供商 APIs           │
          │  (Gemini, Claude, OpenAI, 等)    │
          └────────────────────────────────────┘
```

---

## 路线图（未来考虑）

1. **自动化测试**: 实现单元和 UI 测试
2. **增强分析**: 使用趋势和预测
3. **团队功能**: 共享账户管理
4. **插件系统**: 自定义提供商集成
5. **云同步**: 跨设备设置同步

---

## 参考

- [CLIProxyAPI GitHub 仓库](https://github.com/router-for-me/CLIProxyAPIPlus)
- [Sparkle 框架文档](https://sparkle-project.org/)
- [SwiftUI 文档](https://developer.apple.com/documentation/swiftui)
