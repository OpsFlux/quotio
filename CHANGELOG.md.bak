# 变更日志

Quotio 的所有重要更改都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.1.0/)，
本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/spec/v2.0.0.html)。

## [未发布]

## [0.7.0] - 2026-01-09

### 新增

- **fallback**: 模型故障转移策略系统（实验性）(#136)
  - 创建基于配额可用性自动故障转移的虚拟模型
  - 在 ProxyBridge 中进行请求时的动态故障转移解析
  - 配额耗尽时（429）使用下一个故障转移条目自动重试
  - 启用故障转移时的桥接模式路由
  - 新增故障转移屏幕，用于管理虚拟模型和条目
- **ui**: 添加 ExperimentalBadge 组件，用于标记实验性功能 (a345698)
- **onboarding**: 完全重新设计，采用基于步骤的流程 (#136)
  - 欢迎、模式选择、提供商、远程设置和完成步骤
- **remote**: 远程连接支持，用于连接远程代理服务器 (#136)
- **ui**: CurrentModeBadge 组件，用于显示当前运行模式 (#136)
- **docs**: 添加贡献者公约行为准则 (6c2915b)

### 更改

- **mode**: 使用增强的 OperatingMode 结构重构运行模式系统 (#136)
- **agent**: 当启用故障转移时，通过 ProxyBridge 路由以进行虚拟模型检测 (#136)

### 修复

- **dock**: 修复停靠图标管理和幽灵图标问题 (#133)
- **fallback**: 修复故障转移路由缓存以提高性能 (#133)
- **proxy**: CLIProxyAPIPlus v6.6.92+ 兼容性 (#133)
- **quality**: 代码质量改进和清理 (#135)

## [0.6.0] - 2026-01-06

### 新增

- **kiro**: 完整的 Kiro 提供商集成，支持配额监控和 OAuth 改进 (#118)
  - 重写 KiroQuotaFetcher 以解析实际的 AWS CodeWhisperer API 响应
  - 支持试用账户（500 奖励积分）和付费账户（50 基础积分）
  - 显示正确的剩余百分比，包括过期/重置日期
  - 从订阅信息显示计划类型（例如 "KIRO FREE"）
- **models**: 从代理 `/models` 端点动态获取模型 (#118)
  - 在 UserDefaults 中缓存模型，以便后续更快加载
  - 在代理配置表中添加刷新按钮，带有加载指示器
  - 在选择器下拉菜单中按提供商（Anthropic、OpenAI、Google）对模型进行分组
- **antigravity**: 令牌计数器重置的自动预热调度 (#104)
  - 灵活调度："每 X 分钟"、"每 X 小时"或"每天在[时间]"
  - 基于间隔的调度的即时触发
  - 成本高效的单模型选择，以最小化资源消耗
- **quota**: 改进 Claude Code 配额处理和多账户用户体验 (#109)
  - 过期 OAuth 令牌的身份验证错误检测（约 1 小时 TTL）
  - 令牌过期时显示重新认证按钮
  - AddProviderPopover 中的账户计数徽章
  - 添加多个账户的提示文本
  - 为没有配额 API 的提供商显示"配额不可用"消息

### 更改

- 使用 URLSession 替换 curl 以进行 Claude Code 网络请求 (#109)

### 修复

- **settings**: 修复菜单栏图标切换和停靠可见性 (#107)
  - 修复关闭"显示菜单栏图标"导致窗口和停靠消失的错误
  - 修复重新打开菜单栏图标时未恢复图标的错误
  - 在应用启动时立即应用"在停靠中显示"切换
- **kiro**: 修复 Kiro 账户的菜单栏幽灵图标问题 (#118)
- **kiro**: 当电子邮件为空时显示身份验证提供商名称（例如"Google"）(#118)
- **agent-config**: 调整 AgentConfigSheet 中的页脚高度以获得更好的布局 (#119)
- **quota**: 修复 RequestTracker ISO8601 日期解码不匹配 (#109)

## [0.5.1] - 2026-01-04

### 新增

- **glm**: 添加 GLM 提供商支持，支持基于 API 密钥的配额跟踪 (#77) - 感谢 @prnake 🎉

### 修复

- **detection**: 检查 XDG_DATA_HOME 以进行 fnm 路径检测 (#102)
- **glm**: 解决 GLMQuotaFetcher 中的 Swift 6 并发警告 (#106)

## [0.5.0] - 2026-01-04

### 新增

- 统一的运行模式系统，支持远程管理 (#86)
- **settings**: 添加管理 API 密钥显示和重新生成 (#97)

### 更改

- **changelog**: 清理重复项并为预发布版本添加自动压缩 (fa1a273)
- 内存优化 - 将 RAM 从 150-250MB 减少到 <100MB (#100)

### 修复

- **proxy**: 添加缓冲区以减少停止/启动竞争条件窗口 (#93)
- **settings**: 为路由策略更改添加重启通知 (#94)
- **proxy**: 防止长时间运行后挂起 (#96)

## [0.4.4] - 2026-01-03

### 修复

- **antigravity**: 使用 SQLite3 忙超时和即时事务修复账户切换数据库锁定处理 (#88)

## [0.4.3] - 2026-01-03

### 新增

- 迁移到 Swift 6，采用严格并发 (#83)

### 修复

- **ci**: 解决 bash 正则表达式解析问题并添加手动工作流触发器 (651fd46)
- **ci**: 合并 appcast 条目以使 beta 版本对更新器可见 (33e28a8)
- **antigravity**: 修复在 macOS 15.5+ 上"在 IDE 中使用"挂起的问题 (#81)

## [0.4.2] - 2026-01-02

### 新增

- **可配置刷新频率**: 添加设置以配置自动刷新间隔，默认为 10 分钟 (#76)
- **GitHub Actions CI/CD**: 基于标签和手动触发器的自动化发布工作流 (#74)
  - 添加 `update-changelog.sh` 脚本以自动更新变更日志
  - 添加 `generate-appcast-ci.sh` 用于 CI 兼容的 Sparkle appcast 生成
  - 添加 `quick-release.sh` 辅助脚本用于本地标签创建

### 更改

- **字符串目录本地化**: 从代码内字典迁移到 `Localizable.xcstrings`，跨 4 种语言有 600+ 个键 (#74)
  - 无需应用重启的动态语言切换
  - 使用 `@Observable` 模式现代化 `LanguageManager`
  - 将旧版 "zh" 语言代码迁移到 "zh-Hans"

### 修复

- **Swift 6 并发性**: 解决 Xcode 16.2 的构建错误和并发警告
  - 为枚举计算属性添加 `localizedStatic()` 非隔离变体
  - 修复 `AntigravityDatabaseService`、`AntigravityProcessManager`、`CLIExecutor`、`CLIProxyManager` 中的可发送性问题
- **CI 兼容性**: 将 Xcode 版本更新到 16.2 以兼容 macos-14 运行器
- **构建脚本**: 提高可靠性和错误处理
- **本地化崩溃**: 修复导致编译器错误和应用启动崩溃的重复字典键

## [0.4.1] - 2026-01-02

### 新增

- **法语本地化**: 所有 UI 字符串和 README 文档的完整法语翻译
- **Antigravity 4 组显示**: 使用 4 个模型组替换 3 组显示：Gemini 3 Pro、Gemini 3 Flash、Gemini 3 Image、Claude 4.5 (#66)
  - 在 QuotaScreen 中添加可展开的组行，包含单个模型详细信息
  - 展开时显示模型计数徽章和单个进度条
- **原生菜单栏子菜单**: 为 Antigravity 账户实现 `NSMenuItem.submenu`，支持自动悬停级联 (#66)
  - 响应式提供商选择器 - 切换提供商时账户立即更新（无需关闭菜单）
  - 添加 `rebuildMenuInPlace()` 以便在跨 macOS 桌面时正确刷新菜单

### 修复

- **菜单栏子菜单悬停**: 修复切换 macOS 桌面后子菜单不工作的问题 (#66)
- **菜单栏动态高度**: 修复切换提供商时高度不正确的问题 (#66)
- **菜单栏加载动画**: 使用带有 `.common` RunLoop 模式的 Timer 以在菜单打开时进行动画处理 (#66)
- **模型显示名称**: 在 QuotaScreen 和菜单栏中保持一致的命名 (#66)

## [0.4.0] - 2026-01-01

### 新增

- **自定义 AI 提供商**: 添加和配置您自己的 AI 提供商，支持自定义 API 端点、标头和模型映射 (#62)
- **上游代理支持**: 在设置中配置上游代理 URL，用于企业网络或 VPN 环境 (#63)

### 修复

- **代理空闲挂起**: 防止代理进程在长时间空闲后挂起（问题 #37、#53）

## [0.3.3] - 2025-12-31

### 新增

- **Beta 频道支持**: 通过设置选择加入 beta 更新，使用单独的 Sparkle appcast 源 (#56)
- **动态应用图标**: 应用图标根据更新频道在生产版本和 beta 版本之间自动切换 (#56)
- **隐私模式**: 选项可使用星号隐藏敏感信息（电子邮件、账户名称）(#46)

### 修复

- **ProgressView 崩溃**: 通过使用自定义 SmallProgressView 组件替换 ProgressView 来解决自动布局约束冲突 (#56)
- **版本解析**: 修复 CLIProxyManager 中的版本检查解析 (#56)
- **关于屏幕图标**: 使用可观察对象在切换更新频道时实时更新图标 (#56)
- **菜单栏间距**: 调整水平内边距以匹配原生 macOS 间距 (#50)

## [0.3.2] - 2025-12-30

### 新增

- **中文本地化**: 所有 UI 字符串的完整简体中文翻译 (#39)

### 修复

- **Sparkle 更新循环**: 同步构建号以匹配发布的版本，防止虚假的更新通知

## [0.3.1] - 2025-12-30

### 新增

- **Claude Code 2.0+ 支持**: 从 macOS 钥匙串读取 OAuth 凭据，而不是从 credentials.json (#27)
- **托管代理升级**: 代理二进制文件的版本管理器 (#30)
  - 基于符号链接切换的版本化二进制存储
  - SHA256 校验和验证，实现安全下载
  - 激活前的兼容性检查（空运行）
  - 失败升级的回滚能力
  - 应用启动时自动检查代理更新
  - 升级可用通知
- **IDE 扫描对话框**: 新的基于同意的 IDE 扫描，带有隐私说明 (#33)
- **IDE 配额持久化**: Cursor 和 Trae 配额数据现在在应用重启后持久化
- **本地化**: IDE 扫描 UI 的越南语翻译
- **中文 README**: 简体中文文档 (#35)
- **MIT 许可证**: 项目现在使用 MIT 许可证 (#24)

### 更改

- **关于屏幕重新设计**: 将更新设置移至关于屏幕，采用现代卡片式 UI

### 修复

- **隐私**: 减少文件系统访问以解决 macOS 隐私警告 (#33)
  - 从自动刷新中删除 Cursor 和 Trae - 需要明确的用户扫描
  - 在提供商屏幕上添加"扫描 IDE"按钮，带有同意对话框
  - 不持久存储扫描同意 - 在应用重启时清除
- **代理检测**: 恢复 CLI 二进制路径以进行正确检测
  - GUI 应用不继承用户的 shell PATH，导致 `which` 失败
  - 重新添加常见路径：~/.local/bin、~/.bun/bin、~/.cargo/bin、~/.deno/bin
  - 添加工具特定路径：~/.opencode/bin
  - 添加版本管理器支持：nvm、fnm、Volta、asdf、mise
- **ForEach ID 冲突**: 当 Cursor 和 Trae 共享相同的电子邮件时修复重复 ID 问题 (#33)

## [0.3.0] - 2025-12-29

### 新增

- **独立配额模式**: 无需运行代理服务器即可查看配额和账户 - 非常适合快速查看
- **模式切换器**: 侧边栏中的响应式切换按钮，可在完整模式和仅配额模式之间切换
- **Trae 提供商**: 支持 Trae AI 编程代理，具有配额跟踪功能

### 更改

- **菜单栏重新设计**: 提供商优先布局，改进了与 Liquid Glass 的兼容性
- **菜单栏动画**: 使用基于 Timer 的旋转以实现可靠的刷新动画

### 修复

- **Cursor SQLite**: 使用不可变模式以避免 WAL 文件锁定错误

## [0.2.3] - 2025-12-28

### 修复

- **菜单栏全屏支持**: 使用自定义 NSPanel 替换 NSPopover 以在全屏应用程序中启用可见性 (#13)
- **菜单栏自动聚焦**: 防止面板打开时按钮自动聚焦 (#13)

## [0.2.2] - 2025-12-27

### 新增

- **刷新按钮**: 自动检测提供商部分的手动刷新按钮，用于检测登出更改 (#11)

### 更改

- 将自动刷新间隔从 5 秒增加到 15 秒，以减少连接压力 (#11)

### 修复

- **代理连接泄漏**: 使用适当的生命周期管理修复 ManagementAPIClient 中的 URLSession 连接泄漏 (#11)
- **菜单栏同步**: 修复删除或登出账户时菜单栏未更新的问题 (#11)
- **配额计算**: 在计算菜单栏显示的最低配额时过滤掉未知百分比 (#8)
- **ForEach 重复 ID**: 添加结合 provider+email 的 uniqueId 字段，以防止重复 ID 警告 (#11)
- **竞争条件**: 通过在失效前捕获客户端引用来避免 stopProxy 中的竞争条件 (#11)

## [0.2.1] - 2025-12-27

### 新增

- **外观设置**: 带有系统、亮色和暗色模式选项的新主题设置

### 更改

- 更新和优化了应用截图

### 修复

- **Claude Code 重新配置**: 在重新配置 Claude Code 时保留现有的 settings.json 配置 (#3)
- **仪表板 UI**: 为非手动身份验证提供商隐藏 +Cursor 按钮 (#5)

## [0.2.0] - 2025-12-27

### 新增

- **仅配额模式**: 不运行代理服务器的新应用模式，用于跟踪配额
- **Cursor 配额跟踪**: 直接监控 Cursor IDE 使用情况和配额
- **配额显示模式**: 选择显示已使用或剩余百分比
- **直接提供商身份验证**: 从提供商身份验证文件读取配额（Claude Code、Gemini CLI、Codex CLI）
- 首次设置的模式选择器

### 更改

- **重新设计配额 UI**: 带有改进布局的新分段提供商控制
- **改进的菜单栏设置**: 直接切换，更好的用户体验
- **更好的状态部分**: 改进的侧边栏布局和端口显示格式
- **改进的模式选择器**: 修复切换应用模式时的 UI 冻结

### 修复

- 在代理模式和仅配额模式之间切换时 UI 冻结
- Cursor 被排除在手动添加选项之外（仅配额跟踪）
- 使用 DMG 文件的 appcast 生成

## [0.1.3] - 2025-12-27

### 新增

- 代理启动期间侧边栏中的加载指示器
- 带超时和 SIGKILL 后备的强制终止，以实现可靠的代理关闭
- 按端口清理以处理孤立进程
- Claude Code 配置存储选项（全局与项目本地）
- 使用单独的应用图标进行开发构建区分

### 更改

- 关闭主窗口时菜单栏现在持久存在（应用在后台运行）
- 使用 xcconfig 支持改进构建配置，用于开发/生产分离

### 修复

- 代理进程在运行一段时间后未终止
- 应用退出后仍保留孤立的代理进程
- 从菜单栏退出应用时代理仍在运行

## [0.1.0] - 2025-12-26

### 新增

- **多提供商支持**: 连接 Gemini、Claude、OpenAI Codex、Qwen、Vertex AI、iFlow、Antigravity、Kiro 和 GitHub Copilot 的账户
- **实时仪表板**: 实时监控请求流量、令牌使用率和成功率
- **智能配额管理**: 按账户可视化配额跟踪，采用自动故障转移策略
- **菜单栏集成**: 从菜单栏快速访问服务器状态、配额概览和控制
  - 菜单栏中显示的自定义提供商图标
  - 组合的提供商状态指示器
- **配额显示改进**:
  - GitHub Copilot 配额显示（Chat、Completions、Premium）
  - Antigravity 模型分为 Claude、Gemini Pro 和 Gemini Flash 类别
  - 带有详细细分的可折叠模型组
  - 高精度百分比显示
- **代理配置**: 自动检测并配置 AI 编程工具（Claude Code、OpenCode、Gemini CLI、Amp CLI、Codex CLI、Factory Droid）
- **API 密钥管理**: 为本地代理生成和管理 API 密钥
- **系统通知**: 低配额、账户冷却期和代理状态的提醒
- **设置**:
  - 切换记录到文件，带有动态侧边栏可见性
  - 路由策略配置（轮询/优先填充）
  - 自动启动代理选项
- **关于屏幕**: 带有捐赠选项的应用信息（Momo、银行二维码）
- **Sparkle 自动更新**: 自动更新检查和安装
- **双语支持**: 英语和越南语本地化

### 修复

- 重新打开时工作表状态未重置
- 代理配置在导航时未正确持久化
- CLI 代理配置与 CLIProxyAPI 文档匹配

## [0.0.1] - 2025-12-20

### 新增

- 初始发布
- 基本代理管理
- 通过 OAuth 进行提供商身份验证
- 简单配额显示
